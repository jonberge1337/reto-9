-- HEMOS ELEGIDO ESTE FICHERO COMO FICHERO FINAL PARA EL RETO DEL GRUPO TAILANDIA
-- CREADOR JON BERGERANDI

CREATE TABLE PROVINCIAS(
	COD_PROVINCIA NUMBER(2) NOT NULL,
	PREFIJO_PROVINCIA NUMBER(3),
	DESCRIPCION_PROVINCIA VARCHAR2(20),
		CONSTRAINT PK_PROVINCIAS PRIMARY KEY(COD_PROVINCIA),
		CONSTRAINT UK1_DESCR_PRO UNIQUE(DESCRIPCION_PROVINCIA)
)
/

CREATE TABLE DESCUENTOS(
	TIPO_ARTICULO VARCHAR2(15) NOT NULL,
	DESCUENTO_ARTICULO NUMBER(3) DEFAULT 0,
		CONSTRAINT PK_DESCUENTOS PRIMARY KEY(TIPO_ARTICULO)
)
/

CREATE TABLE MEDIDAS(
	COD_UNIDAD_MEDIDA NUMBER(2) NOT NULL,
	DESCRIPCION_UNIDAD_MEDIDA VARCHAR2(30),
		CONSTRAINT PK_MEDIDAS PRIMARY KEY(COD_UNIDAD_MEDIDA),
		CONSTRAINT UK1_DESCR_UNI_MED UNIQUE(DESCRIPCION_UNIDAD_MEDIDA)
)
/

CREATE TABLE PAISES(
	PAIS VARCHAR2(25) NOT NULL,
	MONEDA VARCHAR2(25),
		CONSTRAINT PK_PAISES PRIMARY KEY(PAIS)
)
/

CREATE TABLE FORMA_PAGO(
	COD_PAGO NUMBER(2) NOT NULL,
	DESCRIPCION_FORMA_PAGO VARCHAR2(15) NOT NULL,
		CONSTRAINT PK_FORMA_PAGO PRIMARY KEY(COD_PAGO),
		CONSTRAINT UK1_DES_FOR_PA UNIQUE(DESCRIPCION_FORMA_PAGO)
)
/

CREATE TABLE PROVEEDORES(
	COD_PROVEEDOR NUMBER(3) NOT NULL,
	NOMBRE_EMPRESA VARCHAR2(25),
	DIRECCION VARCHAR2(30),
	POBLACION VARCHAR2(25),
	TELEFONO VARCHAR2(13),
	COD_PROVINCIA NUMBER(3)NOT NULL,
		CONSTRAINT PK_PROVEEDORES PRIMARY KEY(COD_PROVEEDOR),
		CONSTRAINT FK1_PRO_PROVI FOREIGN KEY(COD_PROVINCIA) REFERENCES PROVINCIAS(COD_PROVINCIA)
)
/

CREATE TABLE ARTICULOS(
	COD_ARTICULO NUMBER(5) NOT NULL,
	TIPO_ARTICULO VARCHAR2(15)NOT NULL,
	DESCRIPCION_ARTICULO VARCHAR2(30),
	PRECIO_VENTA NUMBER(9,2),
	STOCK NUMBER(6),
	STOCK_MINIMO NUMBER(3),
	COD_UNIDAD_MEDIDA NUMBER(2) NOT NULL,
		CONSTRAINT PK_ARTICULOS PRIMARY KEY(COD_ARTICULO, TIPO_ARTICULO),
		CONSTRAINT FK1_ART_DES FOREIGN KEY(TIPO_ARTICULO) REFERENCES DESCUENTOS(TIPO_ARTICULO),
		CONSTRAINT FK2_ART_MED FOREIGN KEY(COD_UNIDAD_MEDIDA) REFERENCES MEDIDAS(COD_UNIDAD_MEDIDA),
		CONSTRAINT CK1_STOCK CHECK(STOCK > STOCK_MINIMO)
)
/

CREATE TABLE CLIENTES(
	COD_CLIENTE NUMBER(7) NOT NULL,
	NOMBRE_EMPRESA VARCHAR2(25),
	NOMBRE_GERENTE VARCHAR2(15),
	APELLIDO1_GERENTE VARCHAR2(15),
	APELLIDO2_GERENTE VARCHAR2(15),
	CIUDAD VARCHAR2(25),
	PAIS VARCHAR2(25) NOT NULL,
	COD_PAGO NUMBER(2) NOT NULL,
		CONSTRAINT PK_CLIENTES PRIMARY KEY(COD_CLIENTE),
		CONSTRAINT FK1_CLI_PAI FOREIGN KEY(PAIS) REFERENCES PAISES(PAIS),
		CONSTRAINT FK2_CLI_FOR_PAG FOREIGN KEY(COD_PAGO) REFERENCES FORMA_PAGO(COD_PAGO)
)
/

CREATE TABLE CAB_PEDIDO(
	NUM_PEDIDO NUMBER(10) NOT NULL,
	FECHA_PEDIDO DATE,
	FECHA_ENVIO DATE,
	FECHA_PAGO DATE,
	ESTADO VARCHAR2(10),
	COD_PAGO NUMBER(2) NOT NULL,
	COD_CLIENTE NUMBER(7) NOT NULL,
		CONSTRAINT PK_CAB_PEDIDO PRIMARY KEY(NUM_PEDIDO),
		CONSTRAINT CK1_FEC_PED CHECK(FECHA_PEDIDO > TO_DATE('01/01/2000', 'DD/MM/YYYY')),
		CONSTRAINT CK2_FEC_PAGO CHECK(FECHA_PAGO >= FECHA_PEDIDO),
		CONSTRAINT CK3_FEC_ENV CHECK(FECHA_ENVIO >= FECHA_PEDIDO),
		CONSTRAINT CK1_ESTADO CHECK(ESTADO IN('PAGADO', 'PENDIENTE'))
		CONSTRAINT FK1_PED_FORMPA FOREIGN KEY(COD_PAGO) REFERENCES FORMA_PAGO(COD_PAGO),
		CONSTRAINT FK2_PED_CLI FOREIGN KEY(COD_CLIENTE) REFERENCES CLIENTES(COD_CLIENTE)
		
)
/

CREATE TABLE CAB_FACTURA(
	NUM_FACTURA NUMBER(7) NOT NULL,
	FECHA_FACTURA DATE,
	PLAZO_PAGO NUMBER(3),
	COD_PROVEEDOR NUMBER(3) NOT NULL,
		CONSTRAINT PK_CAB_FACTURA PRIMARY KEY(NUM_FACTURA),
		CONSTRAINT CK1_PLAZO_PAGO CHECK(PLAZO_PAGO IN(0, 15, 30, 90, 180)),
		CONSTRAINT FK1_PRO_PRO FOREIGN KEY(COD_PROVEEDOR) REFERENCES PROVEEDORES(COD_PROVEEDOR)
)
/

CREATE TABLE CAB_ALBARAN(
	NUM_ALBARAN NUMBER(8) NOT NULL,
	FECHA_ALBARAN DATE,
	NUM_BULTOS NUMBER(2),
	NUM_FACTURA NUMBER(7) NOT NULL,
		CONSTRAINT PK_CAB_ALBARAN PRIMARY KEY(
		NUM_ALBARAN),
		CONSTRAINT FK1_ALB_FAC FOREIGN KEY(NUM_FACTURA) REFERENCES CAB_FACTURA(NUM_FACTURA)
)
/

CREATE TABLE CATALOGO(
	COD_PROVEEDOR NUMBER(3) NOT NULL,
	COD_ARTICULO NUMBER(5) NOT NULL,
	TIPO_ARTICULO VARCHAR2(15) NOT NULL,
	PRECIO_COSTE NUMBER(9,2),
	PLAZO_ENTREGA NUMBER(4),
		CONSTRAINT PK_CATALOGO PRIMARY KEY(COD_PROVEEDOR, COD_ARTICULO, TIPO_ARTICULO),
		CONSTRAINT FK1_CAT_PRO FOREIGN KEY(COD_PROVEEDOR) REFERENCES PROVEEDORES(COD_PROVEEDOR),
		CONSTRAINT FK2_CAT_ART FOREIGN KEY(COD_ARTICULO, TIPO_ARTICULO) REFERENCES ARTICULOS(COD_ARTICULO, TIPO_ARTICULO)
)
/

CREATE TABLE DETALLE_ALBARAN(
	NUM_ALBARAN NUMBER(8) NOT NULL,
	COD_ARTICULO NUMBER(5) NOT NULL,
	TIPO_ARTICULO VARCHAR2(15) NOT NULL,
	PRECIO NUMBER(9,2),
	CANTIDAD NUMBER(4),
		CONSTRAINT PK_DETALLE_ALBARAN PRIMARY KEY(NUM_ALBARAN, COD_ARTICULO, TIPO_ARTICULO),
		CONSTRAINT FK1_DET_ALB_CAB_ALB FOREIGN KEY(NUM_ALBARAN) REFERENCES CAB_ALBARAN(NUM_ALBARAN),
		CONSTRAINT FK2_DET_ALB_ART FOREIGN KEY(COD_ARTICULO, TIPO_ARTICULO) REFERENCES ARTICULOS(COD_ARTICULO, TIPO_ARTICULO)
)
/

CREATE TABLE DETALLE_PEDIDO(
	COD_ARTICULO NUMBER(5) NOT NULL,
	TIPO_ARTICULO VARCHAR2(15) NOT NULL,
	NUM_PEDIDO NUMBER(10) NOT NULL,
	CANTIDAD NUMBER(4),
	PRECIO NUMBER(9,2),
		CONSTRAINT PK_DETALLE_PEDIDO PRIMARY KEY(COD_ARTICULO, TIPO_ARTICULO, NUM_PEDIDO),
		CONSTRAINT FK1_DET_PED_ART FOREIGN KEY(COD_ARTICULO, TIPO_ARTICULO) REFERENCES ARTICULOS(COD_ARTICULO, TIPO_ARTICULO),
		CONSTRAINT FK2_DET_PED_CAB_PED FOREIGN KEY(NUM_PEDIDO) REFERENCES CAB_PEDIDO(NUM_PEDIDO)
)
/

CREATE TABLE DIRECCIONES(
	COD_CLIENTE NUMBER(7) NOT NULL,
	DIRECCION VARCHAR2(30),
		CONSTRAINT DIRECCIONES PRIMARY KEY(COD_CLIENTE, DIRECCION),
		CONSTRAINT FK1_DIR_CLI FOREIGN KEY(COD_CLIENTE) REFERENCES CLIENTES(COD_CLIENTE)
)
/

INSERT INTO PROVINCIAS(COD_PROVINCIA, PREFIJO_PROVINCIA, DESCRIPCION_PROVINCIA)
	VALUES(20, 943, 'GIPUZKOA')
/

INSERT INTO PROVINCIAS(COD_PROVINCIA, PREFIJO_PROVINCIA, DESCRIPCION_PROVINCIA)
	VALUES(28, 944, 'BIZKAIA')
/

INSERT INTO DESCUENTOS(TIPO_ARTICULO, DESCUENTO_ARTICULO)
	VALUES('PERECEDERO', 20)
/

INSERT INTO DESCUENTOS(TIPO_ARTICULO, DESCUENTO_ARTICULO)
	VALUES('CONSERVAS', 7)
/

INSERT INTO MEDIDAS(COD_UNIDAD_MEDIDA, DESCRIPCION_UNIDAD_MEDIDA)
	VALUES(7, 'KILO GRAMO')
/

INSERT INTO MEDIDAS(COD_UNIDAD_MEDIDA, DESCRIPCION_UNIDAD_MEDIDA)
	VALUES(3, 'GRAMO')
/
	
INSERT INTO PAISES(PAIS, MONEDA)
	VALUES('ESPAÑA', 'EURO')
/

INSERT INTO PAISES(PAIS, MONEDA)
	VALUES('NICARAGUA', 'CORDOBA')
/

INSERT INTO FORMA_PAGO(COD_PAGO, DESCRIPCION_FORMA_PAGO)
	VALUES(7, 'GIRO TRES MESES')
/

INSERT INTO FORMA_PAGO(COD_PAGO, DESCRIPCION_FORMA_PAGO)
	VALUES(4, 'AL CONTADO')
/

INSERT INTO PROVEEDORES(COD_PROVEEDOR, NOMBRE_EMPRESA, DIRECCION, POBLACION, TELEFONO, COD_PROVINCIA)
	VALUES(127, 'FRIT RAVICH', 'POLIGONO ABENDAÑO 5', 'ZARAUTZ', '943-84-24-33', 20)
/
	
INSERT INTO PROVEEDORES(COD_PROVEEDOR, NOMBRE_EMPRESA, DIRECCION, POBLACION, TELEFONO, COD_PROVINCIA)
	VALUES(148, 'GONVADOR', 'EUSKO GUDARI 7', 'ORIO', '943-87-84-33', 20)
/

INSERT INTO ARTICULOS(COD_ARTICULO, TIPO_ARTICULO, DESCRIPCION_ARTICULO, PRECIO_VENTA, STOCK, STOCK_MINIMO, COD_UNIDAD_MEDIDA)
	VALUES(348, 'PERECEDERO', 'KINDER ALTO AZUCAR', 1.2, 628, 240, 3)
/	

INSERT INTO ARTICULOS(COD_ARTICULO, TIPO_ARTICULO, DESCRIPCION_ARTICULO, PRECIO_VENTA, STOCK, STOCK_MINIMO, COD_UNIDAD_MEDIDA)
	VALUES(628, 'CONSERVAS', 'ACEITUNAS EN ACEITE', 5, 728, 140, 7)
/

INSERT INTO CLIENTES(COD_CLIENTE, NOMBRE_EMPRESA, NOMBRE_GERENTE, APELLIDO1_GERENTE, APELLIDO2_GERENTE, CIUDAD, PAIS, COD_PAGO)
	VALUES(65214, 'DULZIA', 'JON', 'BERGERANDI', 'LOIDI', 'ZARAUTZ', 'ESPAÑA', 4)
/

INSERT INTO CLIENTES(COD_CLIENTE, NOMBRE_EMPRESA, NOMBRE_GERENTE, APELLIDO1_GERENTE, APELLIDO2_GERENTE, CIUDAD, PAIS, COD_PAGO)
	VALUES(654, 'PELLAS', 'CARLOS', 'PELLAS', 'ROSSI', 'MANAGUA', 'NICARAGUA', 7)
/

INSERT INTO CAB_PEDIDO(NUM_PEDIDO, FECHA_PEDIDO, FECHA_ENVIO, FECHA_PAGO, ESTADO, COD_PAGO, COD_CLIENTE)
	VALUES(725, TO_DATE('12/05/2017', 'DD/MM/YYYY'), TO_DATE('12/05/2017', 'DD/MM/YYYY'), TO_DATE('12/05/2017', 'DD/MM/YYYY'), 'PAGADO', 4, 65214)
/

INSERT INTO CAB_PEDIDO(NUM_PEDIDO, FECHA_PEDIDO, FECHA_ENVIO, FECHA_PAGO, ESTADO, COD_PAGO, COD_CLIENTE)
	VALUES(14521, TO_DATE('12/05/2017', 'DD/MM/YYYY'), TO_DATE('25/05/2017', 'DD/MM/YYYY'), TO_DATE('25/08/2017', 'DD/MM/YYYY'), 'PAGADO', 7, 654)
/

INSERT INTO CAB_FACTURA(NUM_FACTURA, FECHA_FACTURA, PLAZO_PAGO, COD_PROVEEDOR)
	VALUES(74521, TO_DATE('25/08/2017', 'DD/MM/YYYY'), 90, 127)
/

INSERT INTO CAB_FACTURA(NUM_FACTURA, FECHA_FACTURA, PLAZO_PAGO, COD_PROVEEDOR)
	VALUES(65418, TO_DATE('25/09/2017', 'DD/MM/YYYY'), 0, 148)
/

INSERT INTO CAB_ALBARAN(NUM_ALBARAN, FECHA_ALBARAN, NUM_BULTOS, NUM_FACTURA)
	VALUES(65412, TO_DATE('25/09/2017', 'DD/MM/YYYY'), 5, 65418)
/

INSERT INTO CAB_ALBARAN(NUM_ALBARAN, FECHA_ALBARAN, NUM_BULTOS, NUM_FACTURA)
	VALUES(47412, TO_DATE('25/06/2018', 'DD/MM/YYYY'), 3, 65418)
/

INSERT INTO CATALOGO(COD_PROVEEDOR, COD_ARTICULO, TIPO_ARTICULO, PRECIO_COSTE, PLAZO_ENTREGA)
	VALUES(127, 348, 'PERECEDERO', 1.2, 15)
/
INSERT INTO CATALOGO(COD_PROVEEDOR, COD_ARTICULO, TIPO_ARTICULO, PRECIO_COSTE, PLAZO_ENTREGA)
	VALUES(148, 628, 'CONSERVAS', 5, 30)	
/

INSERT INTO DETALLE_PEDIDO(COD_ARTICULO, TIPO_ARTICULO, NUM_PEDIDO, CANTIDAD, PRECIO)
	VALUES(348, 'PERECEDERO', 14521, 541, 1405)
/

INSERT INTO DETALLE_PEDIDO(COD_ARTICULO, TIPO_ARTICULO, NUM_PEDIDO, CANTIDAD, PRECIO)
	VALUES(628, 'CONSERVAS', 725, 261, 2184)
/

INSERT INTO DIRECCIONES(COD_CLIENTE, DIRECCION)
	VALUES(65214, 'TRINIDADE KALEA 1')
/

INSERT INTO DIRECCIONES(COD_CLIENTE, DIRECCION)
	VALUES(654, 'PLAZA CASTILLA NORTE')
/